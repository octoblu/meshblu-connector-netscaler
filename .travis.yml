language: cpp
os:
- linux
- osx
addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - g++-4.8
    - g++-4.8-multilib
    - gcc-multilib
    - build-essential
    - libbluetooth-dev
    - libudev-dev
    - libusb-1.0-0-dev
env:
  matrix:
  - PACKAGER_NODE_VERSION="5.5" PACKAGER_ARCH="amd64" MAIN_BUILD="true"
  - PACKAGER_NODE_VERSION="5.5" PACKAGER_ARCH="386"
matrix:
  exclude:
  - os: osx
    env: PACKAGER_NODE_VERSION="5.5" PACKAGER_ARCH="386"
branches:
  only:
  - "/^v[0-9]/"
before_install:
- PACKAGER_URL="https://meshblu-connector.octoblu.com/tools/packager/latest"
- curl -fsS "${PACKAGER_URL}/travis_install_node.sh" -o /tmp/travis_install_node.sh
- chmod +x /tmp/travis_install_node.sh
- ". /tmp/travis_install_node.sh"
- if [ "$TRAVIS_OS_NAME" == "linux" -a "$MAIN_BUILD" == "true" ]; then export NPM_PUBLISH="true"; fi
install:
- npm install --build-from-source
script:
- npm test
before_deploy:
- npm install --build-from-source --production
- npm install meshblu-connector-packager
- npm dedupe
- npm install -g flatten-packages
- flatten-packages
- npm run package
deploy:
- provider: releases
  api_key:
    secure: "cqrI5rq65JGXTJTfJefxZcmBESA6FCD/GnBH5syLEzrk/zffsNHh+rdVOKynqKhyovJNCCBbP7Am+87j4qZh/aILOR+LjwezNR/6bIkiAm6oKVVM3dVm6JZzEAh2GksdTt05cEAeeZ6iAn7TcDZwes6KXT/wIwHevA7AABeq2L7+/WoAQ8ECEPabk+jc8Lgeds4V1sBXIR211zzKzz+GTpH47IW9/WjA+N/vfIZS4kpIMl6EIbS+6E8UADQbM1zERTQ1nQ8ct3vysGDDCRdKOWVtmqpJz2fuOTKNBefq1Dkf4+gqoQTC0Wo1IU0P4RtRgyNnqTBCSYdGdrlhbJthTx/fb+x3S4pdM+8a2f9aJCpCNk1FWi718U7bb4p5Cx3YsATZdT3KrsiCmjWOEoObpZgTNva+xIivpSlHn1FC6yxxBnBvrJMvlKS3nA1yTfBcFpluRpD3QXft4GKZde0K6lqM6uqK44WQ0FiYe7fD27DCa2+6kxa2X9PCMV/4XQjCvW6gwNWMrI5eysKpZSmEgkohOpFAFGoHpnjr/Egw/vTeepgoby1joQN6cGIV1SC3N8Oai/db9d6Iz7Kjb4SgZbSX2oW9PDlfG9bTXgDmd2VWmS4u18dy7hDRZj04boHSizTUMtOexPP7B4YOhaaJqLFc2UqTqqGSXKj+I4lZ/vo="
  file_glob: true
  file:
  - "deploy/*"
  skip_cleanup: true
  on:
    tags: true
- provider: npm
  email: serveradmin@octoblu.com
  api_key:
    secure: "x2cdkIqRKEEFSpui1ZDEtuba5fcbKNnicJssCUXxWrynJGkFfS8LjiE4pgEivQiUveBG9oQsTqLzO9L8LqFxunS14GSb7l43DKwBCO8b6HMY5AWiRRpxwile6tw0bCv55awEJPjJjLqGEFNxes9l23dTT0Eg05URl/tJKgmUyC3wAk6L4NzQb78hFzPDxJCwmRyLYInAcseioLnVlFJrPHhVKl45+q+lD9klEuTaEq4OJpJkKZnsKpZgBpDHs19R2k2LR7tBu2GLXaj/jjGzFNo9fIXCcPnLE8KUPntzys3PoAQuGQlEgMyk20K249QNUBK5+Ge8U6S5nvBeDPgicAicBEGPKKEeJGKGQQKqyB93UDDuafIlEw4vHkepAzaFqCQEV74x2CyLyNn+bYrUxAm/at5yJHQ/m+cD32skGlRXpTrGIg3t267vAm4+472z76X6s+LZjStmeuIXoyHhj6S9ktrCcuXLkFa4MhW1wXCHX0RNzT0ra8z+9INzBHETMTN+VnzEkL6zDhr0JO+8s9jOgygf2cB6czUK6p1fySU2fw7dCZTO6EJvmEcDJWA9jcNxkwJx9vnowlCAKyn+MI5ApwSOLivaMrJ2N3tug1WYY4ob3fbiYTfHZH+CQZb801lZSJTeXz6+IjsGG+m65CohQF8CgAqUtmGszYNKi/k="
  on:
    tags: true
    condition: "$NPM_PUBLISH = true"
